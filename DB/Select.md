# SELECT查詢指令
- 基本語法：
```
SQL-SELECT
SELECT 欄位清單
FROM 資料表來源 
[WHERE 搜尋條件] 
[GROUP BY 欄位清單]
 [HAVING 搜尋條件]
 [ORDER BY 欄位清單] 
```
| 子句   | 說明  | 
|  ----  | ----  | 
|SELECT|選取欄位|
|FROM|從哪個資料表|
|WHERE| 條件的查詢結果|
|GROUP BY|可以將相同欄位值的欄位群組在一起，以便執行群組查詢|
|HAVING|搭配GROUP BY子句進一步過濾群組查詢的條件|
|ORDER BY|指定查詢結果的排序欄位|

	
# SELECT子句
- 語法：
```	
SELECT [ALL | DISTINCT]
[TOP n | PERCENT] [WITH TIES]
欄位規格 [[AS] 欄位別名] [, 欄位規格 [[AS] 欄位別名]]
``` 
- 說明：
1. ALL是預設值可以顯示所有記錄的欄位值， DISTINCT只顯示不重複欄位值的記錄。
2. TOP關鍵 字可以顯示查詢結果的前幾筆記錄或多少百分比。
3. TIES是處理欄位值平手的情況

- 欄位規格：

| 欄位規格   | 說明  | 
|  ----  | ----  | 
|資料表的欄位|資料表的欄位名稱清單，或 使用「*」符號代表所有欄位|
|計算值欄位|算術運算子、字串或函數組成
   的運算式欄位|
- 範例：
1. 範例1:查詢【學生】資料表的所有學生記錄，不過只顯示學號、姓名和生日三個欄位
```SELECT 學號, 姓名, 生日 FROM 學生```

2. 範例2:查詢【課程】資料表的所有課程記錄並且
 顯示所有欄位
```SELECT * FROM 課程 ```

3. 範例3:查詢【學生】資料表的學號、姓名和生日資料， 為了方便閱讀，顯示欄位名稱為【學生學號】、【學生姓名】和【學生生日】的中文欄位別名
```
SELECT 學號 AS 學生學號, 姓名 AS 學生姓名,
 生日 AS 學生生日
FROM 學生
```

4. 範例4:使用算術運算式來查詢【員工】資料表的薪水資料，顯示每位員工的【薪水淨額】
```
SELECT 身份證字號, 姓名,
 薪水-扣稅 AS 薪水淨額
FROM 員工
```

5. 範例5:從【課程】資料表選取學分欄位，每筆紀錄的學分欄位都不一樣。
```SELECT DISTINCT 學分 FROM 課程 ```

6. 範例6:在【員工】資料表的地址資料是由兩個欄位所組 成，使用字串運算式來顯示員工的地址
```
SELECT 身份證字號, 姓名,
 城市+'巿'+街道 AS 地址 
FROM 員工
``` 
7. 範例7:在【學生】資料表只有學生的生日資料，搭配 T-SQL函數來計算學生的年齡
```
SELECT 學號, 姓名,
GETDATE() AS 今天,
DATEDIFF(year, 生日, GETDATE()) AS 年齡 
FROM 學生 
```
>說明：
>GETDATE()為今天日期
>DATEDIFF(year, start,end)
>以年來計算起始的年份差距(可以改成month,day...)
>可以使用DATEADD()來調整GETDATE時差
>範例:DATEADD(HOUR, 8, GETDATE())
8. 範例8:在【學生】資料表顯示前3筆學生記錄資料
```SELECT TOP 3 * FROM 學生 ```
>補充：前n筆:(TOP n)
9. 範例9:在【學生】資料表取出前25%的學生記錄資料
```SELECT TOP 25 PERCENT * FROM 學生```

10. 範例10:在【課程】資料表取出前3筆課程記錄資料，如果有同學分的記錄也一併顯出來
```
SELECT TOP 3 WITH TIES * FROM 課程 
ORDER BY 學分 
```
# WHERE字句
### 比較運算子

1. 範例1:在【學生】資料表查詢學號為'S002'學生的詳細 資料
```
SELECT * FROM 學生
WHERE 學號='S002'
```

2. 範例2:查詢【員工】資料表的薪水欄位小於50000元的 員工記錄
```
SELECT * FROM 員工
WHERE 薪水<50000
```

3. 範例3:查詢【學生】資料表的學生生日是1993-02-02的 學生記錄
```
SELECT * FROM 學生
WHERE 生日='1998-02-02'
```
### 邏輯運算子

1. 說明:
- T-SQL將述語視為是邏輯運算子，共支援三種述語 ，```LIKE, BETWEEN/AND, IN```
- 字串比對
| 萬用字元   | 說明  | 
|  ----  | ----  |
| % | 代表0或更多任易長度字元的任何字串 |
| _ |代表一個字元長度的任何字元 |
| [] | 符合括號內字元清單的任何一個字元，例如:[ EO ] |
| [ - ] | 符合括號內「-」字元範圍的任何一個字元，例如:[A- J] |
| [ ^ ] | 符合不在括號(K~Y)內字元清單的字元，例如:[ ^K-Y ] |



2. 範例1:查詢【教授】資料表中，屬於資訊相關科系CS和
CIS的教授記錄(只要科系欄位有S都會出現)
```
SELECT * FROM 教授
WHERE 科系 LIKE '%S%'
```

3. 範例2:查詢【班級】資料表中，上課教室有2且後面配數字的課程資料
```
SELECT DISTINCT 課程編號, 上課時間, 教室 FROM 班級
WHERE 教室 LIKE '%2_-%'
```

4. 範例3:查詢【員工】資料表中，身份證字號是A-D範圍
 字母開頭的員工資料
```
SELECT * FROM 員工
WHERE 身份證字號 LIKE '[A-D]%'
```

5. 範例4:查詢【學生】資料表生日欄位範圍是1995年1月1
日到1995年12月31日出生的學生
```
SELECT * FROM 學生
WHERE 生日 BETWEEN '1995-1-1'
AND '1995-12-31'
```

6. 範例5:查詢【課程】資料表看看還有2~3個學分
```
SELECT * FROM 課程
WHERE 學分 BETWEEN 2 AND 3
```

7. 範例6:查詢【課程】資料表關於CS101、CS222、CS100和 CS213四門課
```
SELECT * FROM 課程
WHERE 課程編號 IN ('CS101', 'CS222', 'CS100', 'CS213')
```

8. 範例7:查詢【課程】資料表看看還有2或4個學分
```
SELECT * FROM 課程
WHERE 學分 IN (2, 4)
```

9. 範例8:查詢【課程】資料表的課程編號欄位包含'2'子 字串，和課程名稱欄位有'程式'子字串，或學分大於等於4
```
SELECT * FROM 課程 
WHERE 課程編號 LIKE '%2%'
AND 名稱 LIKE '%程式%'
OR 學分>=4
```

10. 範例9:查詢【員工】資料表的薪水在扣稅和保險金額後
的淨額小於40000元的員工記錄
```
SELECT 身份證字號, 姓名, 電話 FROM 員工
WHERE (薪水-扣稅-保險) < 40000
```

# 聚合函數
| 函數   | 說明  | 
|  ----  | ----  | 
|COUNT(運算式)|計算記錄筆數|
|AVG(運算式)|計算欄位平均值|
|MAX(運算式)|取得記錄欄位的最大值|
|MIN(運算式)|取得記錄欄位的最小值|
|SUM(運算式)|取得記錄欄位的總計|

### COUNT()函數
- 說明:
1. 計算查詢的記錄數
2. 「*」參數可計算欄位不是空值的記錄數。
- 範例:查詢【學生】資料表的學生總數
``` SELECT COUNT(*) AS 學生數 FROM 學生```

### AVG()函數
- 説明:計算指定欄位的平均值
- 範例:在【員工】資料表查詢員工薪水的平均值
```SELECT AVG(薪水) AS 平均薪水 FROM 員工```

### MAX()函數
- 說明:算符合條件記錄的欄位最大值
- 範例:在【員工】資料表查詢保險金額第一名員工的金額
``` SELECT MAX(保險) AS 保險金額 FROM 員工```

### MIN()函數
- 說明:計算出符合條件記錄的欄位最小值
- 範例:在【員工】資料表查詢保險金額最後一名員工的金額
```SELECT MIN(保險) AS 保險金額 FROM 員工```

### SUM()函數
- 說明:計算出符合條件記錄的欄位總和
- 範例:在【員工】資料表計算員工的薪水總和和平均
```
SELECT SUM(薪水) AS 薪水總額,
 SUM(薪水)/COUNT(*) AS 薪水平均
FROM 員工
```

# GROUP BY子句
- 語法:
```GROUP BY 欄位清單```
>備註:如果不只一個，使用「,」逗號分隔
- 範例:在【班級】資料表查詢課程編號和計算每一門課程有多少位學生上課
```
SELECT 課程編號, COUNT(*) AS 學生數
FROM 班級 GROUP BY 課程編號
```
# HAVING子句
- 說明:
1. 配合HAVING子句來指定搜尋條件，以便進一步縮小查詢範圍
2. HAVING子句和WHRE子句的差異:
(a) HAVING子句可以使用聚合函數，但WHERE子句不可以
(b) 在HAVING子句條件所參考的欄位一定屬於 SELECT子句的欄位清單;WHERE子句則可以參考FORM子句資料表來源的所有欄位。
- 語法:
```
HAVING 搜尋條件
```

- 範例1:在【班級】資料表找出學生S002所上課的課程清 單
```
SELECT 學號, 課程編號 FROM 班級
GROUP BY 課程編號, 學號
HAVING 學號 = 'S002'
```

- 範例2:在【班級】資料表找出教授編號是'I003'，其教授 課程有超過2位學生上課的課程清單
```
SELECT 課程編號, COUNT(*) AS 學生數 
FROM 班級
WHERE 教授編號 = 'I003'
GROUP BY 課程編號
HAVING COUNT(*) >= 2
```

# WITH CUBE
- 說明:WITH CUBE是針對GROUP BY子句的各群組欄位執行小計與加總
- 範例:在【班級】資料表找出教授I001和I003教授課程 的學生數小計和加總，和各課程的學生總數
```
SELECT 教授編號, 課程編號,
COUNT(學號) AS 總數
FROM 班級 WHERE 教授編號 IN ('I001', 'I003') GROUP BY 教授編號, 課程編號 WITH CUBE
```

# WITHROLLUP
- 說明:WITH ROLLUP是針對第一個欄位執行加總運算
- 範例:在【班級】資料表找出教授I001和I003教授課程 的學生數小計和加總
```
SELECT 教授編號, 課程編號, COUNT(學號) AS 總數 FROM 班級
WHERE 教授編號 IN ('I001', 'I003')
GROUP BY 教授編號, 課程編號 WITH ROLLUP
```

# GROUPING SETS
- 說明:自行定義傳回哪些欄位的聚合統計資料
- 範例:先找(教授編號, 課程編號)的數量，再找(教授編號)，最後再加起來
SELECT 教授編號, 課程編號, COUNT(學號) AS 總數 FROM 班級
WHERE 教授編號 IN ('I001', 'I003')
GROUP BY GROUPING SETS
( (教授編號, 課程編號), (教授編號),
() )

# ORDER BY
- 基本語法:
```
ORDER BY 運算式 [ASC | DESC] [,運算式 [ASC | DESC]]
```
- 說明:預設是由小到大排序的ASC， 如果希望由大至小，請使用DESC關鍵字

- 範例1:在【員工】資料表查詢薪水大於35000元的員工
記錄，並且使用薪水欄位進行由大至小排序
```
SELECT 姓名, 薪水, 電話 FROM 員工 
WHERE 薪水 > 35000
ORDER BY 薪水 DESC
```

- 範例2:在【員工】資料表查詢薪水大於35000元的員工 記錄，並且使用薪水欄位進行由小至大排序
```
SELECT 姓名, 薪水, 電話 FROM 員工 
WHERE 薪水 > 35000
ORDER BY 薪水 ASC
```
