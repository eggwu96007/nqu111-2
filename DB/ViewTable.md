
# 檢視表說明：
1. 是一個虛擬資料表，本身並沒有儲存資料，只有定義資料，定義從哪些資料表或檢視表挑出哪些欄位或記錄。
2. 檢視表如同是一個從不同資料表或檢視表抽出的資料積木，然後使用這些積木拼出所需的資料表。 

# 檢視表種類:
- 列欄子集檢視表(Row-and-Column Subset Views):
從單一資料表或其他檢視表所導出的檢視表，是資料表或其他檢視表的子集。 
- 合併檢視表(Join Views):
使用合併查詢從多個資料表 或其他檢視表所導出的檢視表，合併檢視表的欄位和記錄 是來自多個資料表或其他檢視表。 
- 統計摘要檢視表(Statistical Summary Views):
一種特 殊的列欄子集檢視表或合併檢視表，只是再使用聚合函數 (Aggregate Function)產生指定欄位所需的統計資料。 

# 檢視表優缺點：
- 優點
1. 達成邏輯資料獨立:檢視表的定義相當於外部與概念對映(External/Conceptual Mapping)，就 算更改資料表的定義資料，也只需同時更改檢視 表的外部與概念對映的定義資料，就可以讓使用 者檢視相同觀點的資料
2. 增加資料安全性:檢視表可以隱藏和過濾資料， 只讓使用者看到它允許看到的資料，可以增加資 料的安全性。
3. 簡化資料查詢:將常用和複雜的查詢定義成檢視表，即可簡化資料查詢。
4. 簡化使用者觀點:檢視表可以增加資料的可讀性， 讓資料庫使用者專注於所需的資料。
- 缺點
1. 執行效率差:檢視表並沒有真正儲存資料，只是一個虛擬資料表，資料是在使用時才從資料表導出，因為經過轉換手續，其執行效率比不過直接存取資料表。
2. 更多的操作限制:檢視表雖然也是一種資料表，不過在新 增、更新和刪除資料時，為了避免違反完整性限制條件， 在操作上有更多的限制。
3. 增加管理的複雜度:檢視表可以一層一層的從其他檢視表導出，複雜的檢視表關聯將增加管理眾多資料表和檢視表的複雜度，因為不小心刪錯檢視表，可能會造成嚴重後果。

# 建立檢視表
- 語法:
```
CREATE VIEW 檢視表名稱 [(欄位別名清單)]
[WITH ENCRYPTION ][ WITH
SCHEMABINDING ] 
AS
SELECT指令敘述
```
## 建立列欄子集檢視表
- 說明：列欄子集檢視表分3種
1. 欄子集檢視表(Column Subset Views):
指檢視表的欄位是資料表欄位集合的子集合。
2. 列子集檢視表(Row Subset Views):
指檢視表的記錄是資料表記錄集合的子集合。
3. 列欄子集檢視表(Row-and-Column Subset Views): 
指檢視表的欄位和記錄都是資料表欄位和記錄集合的子集合。
- 範例
1. 範例1:
在【學生】資料表建立學生電話聯絡資料的【學生聯絡_檢視】的檢視表
```
CREATE VIEW 學生聯絡_檢視 (學號,學生姓名,學生電話) 
AS
SELECT 學號, 姓名, 電話 FROM 學生
GO
SELECT * FROM 學生聯絡_檢視

```
2. 範例2:
在【員工】資料表建立薪水超過50000員工資料 的【高薪員工_檢視】的加密檢視表
```
CREATE VIEW 高薪員工_檢視 
WITH ENCRYPTION
AS
SELECT * FROM 員工
WHERE 薪水 > 50000
GO
SELECT * FROM 高薪員工_檢視
```
3. 範例3:
在【員工】資料表建立薪水超過50000員工資料， 而且只有身份證字號、姓名和電話三個欄位的 【高薪員工聯絡_檢視】檢視表，並且使用結構描 述繫結選項
```
CREATE VIEW 高薪員工聯絡_檢視
WITH SCHEMABINDING AS
SELECT 身份證字號, 姓名, 電話 FROM dbo.員工
WHERE 薪水 > 50000
GO
```
## 建立合併檢視表
- 說明：合併檢視表(Join Views)是多個資料表執 行合併查詢所建立的檢視表
- 範例:
在【學生】、【課程】、【教授】和【班 級】四個資料表建立合併檢視表的【學生_ 班級_檢視】檢視表，可以用來顯示學生的 上課資料
```
CREATE VIEW 學生_班級_檢視 AS SELECT 學生.學號, 學生.姓名, 課程.*, 教授.* FROM 教授 INNER JOIN
(課程 INNER JOIN
(學生 INNER JOIN 班級 ON 學生.學號=班級.學 號)
ON 班級.課程編號 = 課程.課程編號) ON 班級.教授編號 = 教授.教授編號 GO
SELECT * FROM 學生_班級_檢視
```

## 統計摘要檢視表
- 說明：
是一種特殊的列欄子集檢視表或合併檢視表，使用聚合函數(Aggregate Function)產生指定欄位所需的統計資料。

- 範例：
1. 範例1:
建立【學生】、【課程】和【班級】三個資料表 的統計摘要檢視表【學分_檢視】，它是一個合併 檢視表，因為使用COUNT()和SUM()的聚合函數 來顯示每位學生的上課數和所修的總學分
```
CREATE VIEW 學分_檢視 AS
SELECT 學生.學號, COUNT(*) AS 修課數,
SUM(課程.學分) AS 學分數 FROM 學生, 課程, 班級
WHERE 學生.學號 = 班級.學號
AND 課程.課程編號 = 班級.課程編號
GROUP BY 學生.學號
GO
SELECT * FROM 學分_檢視
```

2. 範例2:
修改統計摘要【學分_檢視】檢視表，建 立只顯示學生所修總學分超過6個學分的學 生上課總數和學分數的合併檢視表【高學 分_檢視】
```
CREATE VIEW 高學分_檢視 AS
SELECT 學生.學號, COUNT(*) AS 修課數,
SUM(課程.學分) AS 學分數 
FROM 學生, 課程, 班級
WHERE 學生.學號 = 班級.學號
AND 課程.課程編號 = 班級.課程編號
GROUP BY 學生.學號
HAVING SUM(課程.學分) >= 6 
GO
SELECT * FROM 高學分_檢視

```

## 從其他檢視表建立檢視表
- 範例：
在上一節【學分_檢視】檢視表只顯示學號，可以再次使用此檢視表和【學生】資料表，建立合併檢視表【學生_學分_檢視】來顯示學生姓名 和電話欄位的詳細資料
```
CREATE VIEW 學生_學分_檢視 AS 
SELECT 學分_檢視.*, 學生.姓名, 學生.電話
FROM 學生, 學分_檢視
WHERE 學生.學號 = 學分_檢視.學號
GO
SELECT * FROM 學生_學分_檢視
```
## 補充：WITH CHECK OPTION
- 說明：表示其建立的檢視表在新增、更 新和刪除記錄時，需要檢查完整性限制條件，如 果不符合條件，就顯示錯誤訊息
- 語法：
```
CREATE VIEW 檢視表名稱 AS
SELECT指令敘述
WITH CHECK OPTION
```

# 修改檢視表
- 語法：
```
ALTER VIEW 檢視表名稱 [(欄位別名清單)]
[WITH ENCRYPTION ][ WITH SCHEMABINDING ] AS
SELECT指令敘述
```
- 範例：
修改【學生聯絡 _檢視】檢視表，取消別名且新
增性別欄位
```
ALTER VIEW 學生聯絡_檢視 AS
SELECT 學號, 姓名,性別, 電話 FROM 學生
GO
SELECT * FROM 學生聯絡_檢視
```

# 刪除檢視表
- 語法：
``` DROP VIEW 檢視表名稱 ```
- 範例：
刪除Ch13_3_1_01.sql建立的【學生連絡_檢視】 檢視表
```DROP VIEW 學生聯絡_檢視```

# 編輯檢視表內容
## 新增記錄
- 說明:檢視表因為擁有主鍵，滿 足前述限制條件
- 範例：
在【生日_檢視_有主鍵】檢視表新增一筆學生記錄
```
INSERT INTO 生日_檢視_有主鍵
VALUES ('S016', '江峰', '1997-10-01' )
GO
SELECT * FROM 學生
```
>補充：如果沒有主鍵， 並不滿足前述限制條件，會出現錯誤
> - 範例:
```
INSERT INTO 生日_檢視_沒有主鍵 
VALUES (‘江峰峰’, ‘1997-10-01’)
```

## 更新紀錄
- 範例：
在【生日_檢視_有主鍵】檢視表將學號S016學生的生日改為 '1996-10-01'
```
UPDATE 生日_檢視_有主鍵
SET 生日 = '1996-10-01' WHERE 學號 = 'S016'
GO
SELECT * FROM 學生
```

## 刪除紀錄
- 範例：
在【生日_檢視_有主鍵】檢視表刪除學號S016的學生資料
```
DELETE FROM 生日_檢視_有主鍵 
WHERE 學號='S016'
GO
SELECT * FROM 學生
```


